<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>育休プロンプト生成結果</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">

    <!-- ChatGPTへの案内 -->
    <div class="chatgpt-link-box">
        <h2>ChatGPTで育休プランを確認する</h2>
        <p>下に表示されたプロンプトをコピーして、以下のリンクからChatGPTに貼り付けてください。</p>
        <p><a href="https://chat.openai.com/" target="_blank" style="font-weight: bold; color: #00a67e; text-decoration: underline;">ChatGPTを開く（新しいタブ）</a></p>
        <p>※プロンプトはこの画面下部に表示されています。</p>
    </div>

    <!-- ステップ1：生成済みプロンプト -->
    <h1>ChatGPTプロンプト</h1>
    <button type="button" class="btn secondary-btn" onclick="copyToClipboard('promptText1')">このプロンプトをコピー</button>
    <textarea id="promptText1" class="prompt-text" rows="50">{{ prompt | safe }}</textarea>

    <!-- ステップ2：非同期 -->
    <div class="section" style="margin-top: 50px;">
        <h2>ステップ2：選んだプランの詳細を依頼</h2>
        <form id="followupForm">
            <label for="selected_plan">選んだプランを選択してください：</label><br>
            <select name="selected_plan" id="selected_plan" required>
                <option value="">-- プランを選んでください --</option>
                <option value="①">① 私たちの希望を最大限反映した育休取得プラン</option>
                <option value="②">② 給付金・社会保険料の免除等、経済的な面を最大限活用したプラン</option>
                <option value="③">③ 希望を反映しつつ夫と妻の協業体制が強化できるプラン</option>
            </select>
            <button type="submit" class="btn secondary-btn">このプランについて詳しく聞く</button>
        </form>
        <div id="step2-result" style="margin-top: 20px;"></div>
    </div>

    <!-- ステップ3：非同期 -->
    <div class="section" style="margin-top: 60px;">
        <h2>オプション：有給休暇を反映したスケジュールを依頼</h2>
        <form id="carryoverForm">
            <label for="paid_leave_days">翌年に持ち越せない有給休暇の日数（日）：</label>
            <input type="number" name="paid_leave_days" id="paid_leave_days" min="1" required placeholder="例：5">
            <button type="submit" class="copy-btn">プロンプトを生成する</button>
        </form>
        <div id="step3-result" style="margin-top: 20px;"></div>
    </div>

    <!-- ステップ4：非同期 -->
    <div class="section" style="margin-top: 60px;">
        <h2>ステップ4：勤務先人事への相談メールを作成</h2>
        <form id="emailForm">
            <label for="email_target">作成するメール：</label><br>
            <select name="email_target" id="email_target" required>
                <option value="">-- 選択してください --</option>
                <option value="husband">夫が勤務先に送る相談メール</option>
                <option value="wife">妻が勤務先に送る相談メール</option>
            </select>
            <button type="submit" class="copy-btn">メール文を生成する</button>
        </form>
        <div id="step4-result" style="margin-top: 20px;"></div>
    </div>
</div>

<script>
function copyToClipboard(id) {
    const textarea = document.getElementById(id);
    textarea.select();
    textarea.setSelectionRange(0, 99999);
    document.execCommand("copy");
    alert("プロンプトをコピーしました！");
}

document.getElementById("followupForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const selected_plan = document.getElementById("selected_plan").value;
    if (!selected_plan) return alert("プランを選択してください。");

    const response = await fetch("/followup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ selected_plan })
    });
    const data = await response.json();
    document.getElementById("step2-result").innerHTML = `
        <h4>送信したプロンプト</h4>
        <button type="button" class="btn secondary-btn" onclick="copyToClipboard('promptText2')">このプロンプトをコピー</button>
        <textarea id="promptText2" class="prompt-text" rows="30">${data.prompt}</textarea>`;
});

document.getElementById("carryoverForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const days = document.getElementById("paid_leave_days").value;
    if (!days) return alert("日数を入力してください。");

    const response = await fetch("/carryover", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ paid_leave_days: days })
    });
    const data = await response.json();
    document.getElementById("step3-result").innerHTML = `
        <h4>生成されたプロンプト</h4>
        <button type="button" class="btn secondary-btn" onclick="copyToClipboard('carryoverPrompt')">このプロンプトをコピー</button>
        <textarea id="carryoverPrompt" class="prompt-text" rows="20">${data.prompt}</textarea>`;
});

document.getElementById("emailForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const target = document.getElementById("email_target").value;
    if (!target) return alert("対象を選択してください。");

    const response = await fetch("/email", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email_target: target })
    });
    const data = await response.json();
    document.getElementById("step4-result").innerHTML = `
        <h4>生成されたメール文</h4>
        <button type="button" class="btn secondary-btn" onclick="copyToClipboard('emailPrompt')">メールをコピー</button>
        <textarea id="emailPrompt" class="prompt-text" rows="25">${data.prompt}</textarea>`;
});
</script>
</body>
</html>
